<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shekinah's @18 RSVP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body { font-family:'Montserrat', sans-serif; background:url('https://i.imgur.com/AUfRfam.jpeg') no-repeat center center fixed; background-size:cover; margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; position:relative; }
body::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); z-index:0; }
.card { position:relative; z-index:1; background:rgba(255,255,255,0.95); max-width:450px; width:90%; padding:35px; border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.3); text-align:center; color:#4b0000; transition:all 0.5s ease; }
h1 { font-family:'Great Vibes', cursive; font-size:3rem; color:#800000; margin-bottom:10px; }
p { font-size:1rem; margin-bottom:20px; }
.input-container { display:flex; gap:10px; margin-bottom:15px; }
.input-container input { flex:1; }
input, select, button { padding:14px; border-radius:12px; border:1px solid #800000; font-size:16px; }
input:focus, select:focus { outline:none; border:2px solid #a00000; box-shadow:0 0 10px rgba(160,0,0,0.3); }
button { background:#800000; color:#fff; font-weight:600; cursor:pointer; transition:all 0.3s ease; }
button:hover { background:#a00000; box-shadow:0 5px 15px rgba(160,0,0,0.4); }
.hidden { display:none; }
#message { font-weight:600; margin:15px 0; font-size:1rem; }
#thankYouCard { display:none; background:#fff8f8; padding:25px; border-radius:15px; margin-top:20px; color:#800000; font-size:1.2rem; font-weight:600; opacity:0; transform:translateY(20px); transition:all 0.7s ease; }
#thankYouCard.show { display:block; opacity:1; transform:translateY(0); }
@media screen and (max-width:480px) { .card{max-width:320px;padding:25px;} h1{font-size:2.2rem;} input,select,button{padding:12px;font-size:15px;} #thankYouCard{font-size:1rem;padding:20px;} .input-container{flex-direction:column;} .input-container button{width:100%;} }
</style>
</head>
<body>

<div class="card">
  <h1>Shekinah's @18</h1>
  <p>Please enter your full name to RSVP</p>

  <div class="input-container">
    <input type="text" id="guestName" placeholder="Full Name">
    <button type="button" onclick="searchGuest()">Search</button>
  </div>

  <p id="message"></p>

  <!-- RSVP form -->
  <form id="rsvpForm" class="hidden" method="POST" target="hidden_iframe">
    <div id="membersList"></div>
    <button type="submit">Confirm RSVP</button>
  </form>

  <div id="thankYouCard"></div>
</div>

<!-- Hidden iframe to submit without CORS -->
<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
// Replace this with your deployed Apps Script web app URL
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxybhfH2wbKW3sEVuyzhO7FX7tVeOasZF1A6njSFHxhZwm-2RM9rJMKdQP8oYwRADEk/exec";

function searchGuest() {
  const name = document.getElementById("guestName").value.trim();
  const message = document.getElementById("message");
  const form = document.getElementById("rsvpForm");
  const membersList = document.getElementById("membersList");
  const thankYouCard = document.getElementById("thankYouCard");

  message.innerText = "";
  membersList.innerHTML = "";
  form.classList.add("hidden");
  thankYouCard.classList.remove("show");

  if (!name) { 
    message.innerText = "Please enter your name."; 
    return; 
  }

  // GET request to Apps Script to get group members
  fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}`)
    .then(res => res.json())
    .then(data => {
      if (!data.found || !data.members || data.members.length === 0) {
        message.innerText = "Name not on the guest list.";
        return;
      }

      message.innerText = "Please confirm RSVP for your group members:";
      form.classList.remove("hidden");

      // Generate inputs for each member
      data.members.forEach(member => {
        const div = document.createElement("div");
        div.style.marginBottom = "10px";
        div.innerHTML = `
          <span>${member.name}</span>
          <input type="hidden" name="row" value="${member.row}">
          <select name="attendance" required>
            <option value="">--Select--</option>
            <option value="Yes" ${member.attendance === "Yes" ? "selected" : ""}>Yes</option>
            <option value="No" ${member.attendance === "No" ? "selected" : ""}>No</option>
          </select>
        `;
        membersList.appendChild(div);
      });
    })
    .catch(() => { message.innerText = "Error connecting to server."; });
}

// Show thank-you after submission (hidden iframe will handle POST)
document.getElementById("rsvpForm").addEventListener("submit", function() {
  this.classList.add("hidden");
  document.getElementById("message").innerText = "";
  const thankYouCard = document.getElementById("thankYouCard");
  thankYouCard.innerText = "RSVP saved! Thank you ðŸ’–";
  thankYouCard.style.display = "block";
  setTimeout(() => thankYouCard.classList.add("show"), 50);
});
</script>

</body>
</html>
